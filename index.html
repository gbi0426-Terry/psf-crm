<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>朋睿國際 CRM V5.0 (Modern UI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        psf: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a', 800: '#166534', 900: '#14532d' }, // Green/Teal Theme
                        brand: { 50: '#f0f9ff', 500: '#0ea5e9' }
                    },
                    boxShadow: {
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)'
                    }
                }
            }
        }
    </script>
    <style>
        .drag-card { cursor: grab; } .drag-card:active { cursor: grabbing; }
        .page-enter { animation: fadeUp 0.4s ease-out; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body { background-color: #f8fafc; }
        .card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
    </style>
</head>
<body class="text-slate-800 font-sans h-screen flex flex-col overflow-hidden">

    <!-- Login -->
    <div id="login-screen" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h1 class="text-2xl font-bold text-slate-800 mb-2">朋睿國際 CRM</h1>
            <p class="text-sm text-gray-500 mb-6">V5.0 Modern UI</p>
            <div class="space-y-4 text-left">
                <div><label class="block text-xs font-bold text-gray-700 mb-1">帳號</label><input type="text" id="login-user" class="w-full border rounded p-2" placeholder="admin / terry / client"></div>
                <div><label class="block text-xs font-bold text-gray-700 mb-1">密碼</label><input type="password" id="login-pass" class="w-full border rounded p-2" placeholder="••••"></div>
                <button onclick="attemptLogin()" class="w-full bg-psf-600 text-white py-3 rounded-lg font-bold hover:bg-psf-700 transition shadow-lg">登入系統</button>
            </div>
            <div class="mt-6 border-t pt-4 text-xs text-gray-400 space-y-1">
                <p>測試帳號：</p>
                <div class="flex justify-center gap-3">
                    <span class="cursor-pointer hover:text-psf-600" onclick="fillLogin('terry', '1234')">顧問(Terry)</span>
                    <span class="cursor-pointer hover:text-psf-600" onclick="fillLogin('client', '1234')">客戶</span>
                </div>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div id="app-container" class="flex-1 flex overflow-hidden hidden">
        <aside id="sidebar" class="w-64 bg-white text-slate-600 flex flex-col border-r z-30 flex-shrink-0 transition-all duration-300">
            <!-- Sidebar Content -->
        </aside>
        <main class="flex-1 flex flex-col relative overflow-hidden">
            <header class="h-16 bg-white border-b flex items-center justify-between px-8 z-20">
                <div class="flex items-center gap-4">
                    <button id="back-btn" onclick="goBack()" class="hidden text-slate-400 hover:text-slate-800"><i class="fa-solid fa-arrow-left text-xl"></i></button>
                    <h2 id="page-title" class="text-xl font-bold text-slate-800">總覽</h2>
                </div>
                <div class="flex items-center gap-4">
                    <span id="user-info" class="text-sm text-slate-500 bg-gray-100 px-3 py-1 rounded-full">訪客</span>
                    <button onclick="logout()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-sign-out-alt"></i></button>
                </div>
            </header>
            <div id="main-view" class="flex-1 overflow-auto p-8 relative">
                
                <!-- DASHBOARD V5 (Template Style) -->
                <div id="view-dashboard" class="view-section page-enter hidden h-full flex flex-col space-y-6">
                    <!-- Cards Row -->
                    <div class="grid grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-soft hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="card-icon bg-green-50 text-green-600"><i class="fa-solid fa-sack-dollar"></i></div>
                                <span class="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">+12.5%</span>
                            </div>
                            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">本月核貸總額</div>
                            <div class="text-2xl font-bold text-slate-800" id="dash-kpi-1">NT$ 5,000萬</div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-soft hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="card-icon bg-blue-50 text-blue-600"><i class="fa-solid fa-chart-line"></i></div>
                                <span class="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">+8.2%</span>
                            </div>
                            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">預估佣金營收</div>
                            <div class="text-2xl font-bold text-slate-800" id="dash-kpi-2">NT$ 250萬</div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-soft hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="card-icon bg-purple-50 text-purple-600"><i class="fa-solid fa-briefcase"></i></div>
                                <span class="text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded">Active</span>
                            </div>
                            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">進行中案件</div>
                            <div class="text-2xl font-bold text-slate-800" id="dash-kpi-3">12</div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-soft hover:shadow-md transition">
                            <div class="flex justify-between items-start mb-4">
                                <div class="card-icon bg-red-50 text-red-600"><i class="fa-solid fa-bell"></i></div>
                                <span class="text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded">3 Urgent</span>
                            </div>
                            <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">急件 / 待處理</div>
                            <div class="text-2xl font-bold text-slate-800" id="dash-kpi-4">3</div>
                        </div>
                    </div>

                    <!-- Status Bars (Inventory Style) -->
                    <div class="bg-white p-8 rounded-2xl border border-gray-100 shadow-soft">
                        <h3 class="font-bold text-slate-800 mb-6">佣金狀態總覽</h3>
                        <div class="space-y-4">
                            <div class="bg-yellow-50 p-4 rounded-xl flex justify-between items-center border border-yellow-100">
                                <div>
                                    <div class="text-xs text-yellow-600 font-bold mb-1">待結算 (Pending)</div>
                                    <div class="text-xl font-bold text-slate-800">NT$ 1,575,000</div>
                                </div>
                                <span class="text-yellow-500"><i class="fa-solid fa-clock"></i> 處理中</span>
                            </div>
                            <div class="bg-green-50 p-4 rounded-xl flex justify-between items-center border border-green-100">
                                <div>
                                    <div class="text-xs text-green-600 font-bold mb-1">已結算 (Paid)</div>
                                    <div class="text-xl font-bold text-slate-800">NT$ 925,000</div>
                                </div>
                                <span class="text-green-500"><i class="fa-solid fa-check-circle"></i> 已入帳</span>
                            </div>
                        </div>
                    </div>

                    <!-- Leaderboard & Recent -->
                    <div class="grid grid-cols-2 gap-6">
                        <div class="bg-white p-8 rounded-2xl border border-gray-100 shadow-soft">
                            <h3 class="font-bold text-slate-800 mb-6">業務績效排行 Top 5</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-8 h-8 rounded-full bg-yellow-100 text-yellow-700 flex items-center justify-center font-bold text-xs">1</div>
                                        <div class="font-bold text-slate-700">Terry</div>
                                    </div>
                                    <div class="text-right"><div class="font-bold text-slate-800">NT$ 250萬</div><div class="text-xs text-gray-400">5 件</div></div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-8 h-8 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center font-bold text-xs">2</div>
                                        <div class="font-bold text-slate-700">Alex</div>
                                    </div>
                                    <div class="text-right"><div class="font-bold text-slate-800">NT$ 180萬</div><div class="text-xs text-gray-400">3 件</div></div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <div class="w-8 h-8 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center font-bold text-xs">3</div>
                                        <div class="font-bold text-slate-700">Sarah</div>
                                    </div>
                                    <div class="text-right"><div class="font-bold text-slate-800">NT$ 90萬</div><div class="text-xs text-gray-400">2 件</div></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-8 rounded-2xl border border-gray-100 shadow-soft">
                            <h3 class="font-bold text-slate-800 mb-6">最新動態</h3>
                            <div class="space-y-4">
                                <div class="flex gap-4">
                                    <div class="w-2 h-2 mt-2 rounded-full bg-blue-500 flex-shrink-0"></div>
                                    <div><div class="font-bold text-sm text-slate-700">鴻海精密 - 送件</div><div class="text-xs text-gray-400">2 小時前 • Terry</div></div>
                                </div>
                                <div class="flex gap-4">
                                    <div class="w-2 h-2 mt-2 rounded-full bg-green-500 flex-shrink-0"></div>
                                    <div><div class="font-bold text-sm text-slate-700">王大明 - 轉介成功</div><div class="text-xs text-gray-400">5 小時前 • System</div></div>
                                </div>
                                <div class="flex gap-4">
                                    <div class="w-2 h-2 mt-2 rounded-full bg-red-500 flex-shrink-0"></div>
                                    <div><div class="font-bold text-sm text-slate-700">台積電 - 缺件通知</div><div class="text-xs text-gray-400">昨天 • Admin</div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Placeholders for other views (using V4.1 logic) -->
                <div id="view-leads" class="view-section page-enter hidden h-full flex flex-col"><div class="text-center mt-20 text-gray-400">線索池 (V5.0 Style WIP)</div></div>
                <div id="view-pipeline" class="view-section page-enter hidden h-full flex flex-col"><div class="text-center mt-20 text-gray-400">案件總管 (V5.0 Style WIP)</div></div>
                <div id="view-partners" class="view-section page-enter hidden h-full flex flex-col"><div class="text-center mt-20 text-gray-400">銀行窗口 (V5.0 Style WIP)</div></div>
                <div id="view-case-detail" class="view-section page-enter hidden h-full flex flex-col"><div class="text-center mt-20 text-gray-400">案件詳情 (V5.0 Style WIP)</div></div>
                
                <!-- Client/Admin Views -->
                <div id="view-client" class="view-section page-enter hidden h-full"></div>
                <div id="view-admin" class="view-section page-enter hidden h-full"></div>

            </div>
        </main>
    </div>

    <script>
        const db = {
            users: [{id:'U1',username:'admin',password:'admin',name:'Terry(Admin)',role:'admin'},{id:'U2',username:'terry',password:'1234',name:'Terry(Consultant)',role:'consultant'},{id:'U3',username:'client',password:'1234',name:'劉揚偉',role:'client'}]
        };

        function attemptLogin() {
            const u = document.getElementById('login-user').value; const p = document.getElementById('login-pass').value;
            const acc = db.users.find(x => x.username === u && x.password === p);
            if(acc) loginAs(acc.role, acc.name); else alert('帳號或密碼錯誤');
        }
        function fillLogin(u, p) { document.getElementById('login-user').value = u; document.getElementById('login-pass').value = p; }
        function loginAs(role, name) {
            document.getElementById('login-screen').classList.add('hidden'); document.getElementById('app-container').classList.remove('hidden');
            renderSidebar(role);
            if(role === 'consultant') router('dashboard'); 
            else if(role === 'client') renderClientDashboard();
            else if(role === 'admin') renderAdminDashboard();
            document.getElementById('user-info').innerText = name;
        }
        function logout() { location.reload(); }

        function renderSidebar(role) {
            const sb = document.getElementById('sidebar');
            // V5.0 Style Sidebar (Light)
            let html = `<div class="h-16 flex items-center px-8 border-b"><h1 class="text-lg font-bold tracking-wider text-psf-600"><i class="fa-solid fa-cube mr-2"></i> 朋睿 CRM</h1></div><nav class="p-4 space-y-1">`;
            if(role === 'consultant') html += `<a onclick="router('dashboard')" id="nav-dashboard" class="nav-item flex items-center px-4 py-3 text-slate-500 hover:bg-psf-50 hover:text-psf-600 rounded-xl transition font-medium cursor-pointer"><i class="fa-solid fa-chart-pie w-6"></i> 儀表板</a><a onclick="router('leads')" id="nav-leads" class="nav-item flex items-center px-4 py-3 text-slate-500 hover:bg-psf-50 hover:text-psf-600 rounded-xl transition font-medium cursor-pointer"><i class="fa-solid fa-filter w-6"></i> 線索池</a><a onclick="router('pipeline')" id="nav-pipeline" class="nav-item flex items-center px-4 py-3 text-slate-500 hover:bg-psf-50 hover:text-psf-600 rounded-xl transition font-medium cursor-pointer"><i class="fa-solid fa-bars-progress w-6"></i> 案件管理</a><a onclick="router('partners')" id="nav-partners" class="nav-item flex items-center px-4 py-3 text-slate-500 hover:bg-psf-50 hover:text-psf-600 rounded-xl transition font-medium cursor-pointer"><i class="fa-solid fa-building-columns w-6"></i> 銀行庫</a>`;
            else if(role === 'client') html += `<a class="flex items-center px-4 py-3 text-white bg-psf-600 rounded-xl shadow-sm"><i class="fa-solid fa-home w-6"></i> 我的案件</a>`;
            else if(role === 'admin') html += `<a class="flex items-center px-4 py-3 text-slate-500 hover:bg-gray-100 rounded-xl"><i class="fa-solid fa-users-gear w-6"></i> 系統管理</a>`;
            html += `</nav>`; sb.innerHTML = html;
        }

        function router(view) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => { el.classList.remove('bg-psf-50', 'text-psf-600'); el.classList.add('text-slate-500'); });
            const nav = document.getElementById(`nav-${view}`); if(nav) { nav.classList.add('bg-psf-50', 'text-psf-600'); nav.classList.remove('text-slate-500'); }
            const titles = { 'dashboard':'總覽', 'leads':'線索管理', 'pipeline':'案件管理', 'partners':'銀行資料庫' };
            document.getElementById('page-title').innerText = titles[view] || 'CRM';
        }

        function renderClientDashboard() { document.getElementById('main-view').innerHTML = `<div class="max-w-4xl mx-auto"><div class="bg-white rounded-2xl shadow-soft p-8 mb-6 border border-gray-100"><div class="flex justify-between mb-6"><h2 class="text-2xl font-bold text-slate-800">鴻海精密</h2><span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-bold">審查中</span></div><div class="h-3 bg-gray-100 rounded-full mb-2"><div class="h-3 bg-psf-500 rounded-full" style="width: 50%"></div></div><p class="text-sm text-gray-400 mt-2">案件進度 50% - 銀行審核文件</p></div></div>`; }
        function renderAdminDashboard() { document.getElementById('main-view').innerHTML = `<div class="bg-white rounded-2xl shadow-soft p-6 border border-gray-100"><h3 class="font-bold mb-4">使用者管理</h3><table class="w-full text-left text-sm"><tr class="border-b"><th class="py-2">姓名</th><th class="py-2">角色</th><th class="py-2">狀態</th></tr><tr><td class="py-3">Terry</td><td>Admin</td><td class="text-green-500">● Active</td></tr></table></div>`; }
        function goBack() { router('pipeline'); }
        function logout() { location.reload(); }
    </script>
</body>
</html>
