<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>朋睿國際 - 企業融資管理平台 V4.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { psf: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 800: '#075985', 900: '#0c4a6e' } }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 font-sans h-screen flex flex-col overflow-hidden">

    <!-- Login Simulation -->
    <div id="login-screen" class="fixed inset-0 z-50 bg-slate-900 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h1 class="text-2xl font-bold text-slate-800 mb-2">朋睿國際 CRM</h1>
            <p class="text-sm text-gray-500 mb-6">請輸入帳號密碼登入</p>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-1">帳號 (Username)</label>
                    <input type="text" id="login-user" class="w-full border rounded p-2 focus:ring-2 focus:ring-psf-500 outline-none" placeholder="admin / terry / client">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-1">密碼 (Password)</label>
                    <input type="password" id="login-pass" class="w-full border rounded p-2 focus:ring-2 focus:ring-psf-500 outline-none" placeholder="••••">
                </div>
                <button onclick="attemptLogin()" class="w-full bg-psf-600 text-white py-3 rounded-lg font-bold hover:bg-psf-700 transition shadow-lg">登入系統</button>
            </div>

            <div class="mt-6 border-t pt-4 text-xs text-gray-400 space-y-1">
                <p>測試帳號：</p>
                <div class="flex justify-center gap-3">
                    <span class="cursor-pointer hover:text-psf-600" onclick="fillLogin('admin', 'admin')">Admin</span>
                    <span class="cursor-pointer hover:text-psf-600" onclick="fillLogin('terry', '1234')">顧問(Terry)</span>
                    <span class="cursor-pointer hover:text-psf-600" onclick="fillLogin('client', '1234')">客戶(鴻海)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- APP CONTAINER -->
    <div id="app-container" class="flex-1 flex overflow-hidden hidden">
        <aside id="sidebar" class="w-64 bg-slate-900 text-white flex flex-col shadow-xl z-30 flex-shrink-0 transition-all duration-300"></aside>
        <main class="flex-1 flex flex-col bg-slate-50 relative overflow-hidden">
            <header class="h-16 bg-white shadow-sm flex items-center justify-between px-8 z-20">
                <h2 id="header-title" class="text-xl font-bold text-slate-800">總覽</h2>
                <div class="flex items-center gap-4">
                    <span id="user-info" class="text-sm text-slate-500">訪客</span>
                    <button onclick="logout()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-sign-out-alt"></i></button>
                </div>
            </header>
            <div id="main-view" class="flex-1 overflow-auto p-6"></div>
        </main>
    </div>

    <script>
        const db = {
            user: null,
            users: [
                { id: 'U1', username: 'admin', password: 'admin', name: 'Terry (Admin)', role: 'admin', status: 'active' },
                { id: 'U2', username: 'terry', password: '1234', name: 'Terry (Consultant)', role: 'consultant', status: 'active' },
                { id: 'U3', username: 'partner', password: '1234', name: '王大明', role: 'partner', status: 'active' },
                { id: 'U4', username: 'client', password: '1234', name: '劉揚偉', role: 'client', status: 'active' }
            ],
            leads: [
                { id: 'L01', name: '張先生', status: 'new', history: [{date:'2026/02/10', user:'Terry', note:'收到線索'}] },
                { id: 'L02', name: '宏達電通', status: 'working', history: [{date:'2026/02/09', user:'Terry', note:'已電訪確認需求'}] }
            ],
            cases: [
                { id: 'C01', client: '鴻海精密', type: '企業融資', stage: 3, amount: '5,000萬', docs: [{name:'401報表', status:'approved', note:'OK'}, {name:'身分證', status:'missing', note:'缺正反面'}] }
            ]
        };

        const stages = ['初談', '文件準備', '送件', '審查', '核准', '撥款', '結案'];

        function attemptLogin() {
            const user = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            const account = db.users.find(u => u.username === user && u.password === pass);
            
            if(account) {
                loginAs(account.role, account.name);
            } else {
                alert('帳號或密碼錯誤！\n(提示: admin/admin)');
            }
        }

        function fillLogin(u, p) {
            document.getElementById('login-user').value = u;
            document.getElementById('login-pass').value = p;
        }

        function loginAs(role, name) {
            db.user = role;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            renderSidebar();
            if(role === 'admin') renderAdminDashboard();
            if(role === 'consultant') renderConsultantDashboard();
            if(role === 'client') renderClientDashboard();
            if(role === 'partner') renderPartnerDashboard();
            document.getElementById('user-info').innerText = name || role.toUpperCase();
        }
        function logout() { location.reload(); }

        function renderSidebar() {
            const sb = document.getElementById('sidebar');
            let menu = '';
            if(db.user === 'admin') menu = `<a onclick="renderAdminDashboard()" class="menu-item"><i class="fa-solid fa-users-gear"></i> 帳號權限管理</a><a onclick="alert('系統設定')" class="menu-item"><i class="fa-solid fa-cogs"></i> 系統設定</a>`;
            if(db.user === 'consultant') menu = `<a onclick="renderConsultantDashboard()" class="menu-item"><i class="fa-solid fa-bars-progress"></i> 案件看板</a><a onclick="renderLeadsManage()" class="menu-item"><i class="fa-solid fa-filter"></i> 線索跟進</a>`;
            if(db.user === 'client') menu = `<a onclick="renderClientDashboard()" class="menu-item"><i class="fa-solid fa-home"></i> 我的案件</a>`;
            
            sb.innerHTML = `<div class="h-16 flex items-center px-6 bg-slate-800 font-bold">朋睿 CRM</div><nav class="p-4 space-y-2">${menu.replace(/class="menu-item"/g, 'class="flex items-center px-4 py-3 text-slate-300 hover:bg-slate-800 hover:text-white rounded cursor-pointer gap-3"')}</nav>`;
        }

        // --- ADMIN VIEW ---
        function renderAdminDashboard() {
            document.getElementById('header-title').innerText = '系統管理後台';
            const main = document.getElementById('main-view');
            main.innerHTML = `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h3 class="font-bold text-lg">使用者與權限管理 (User & RBAC)</h3>
                        <button class="bg-psf-600 text-white px-4 py-2 rounded shadow hover:bg-psf-700" onclick="alert('新增使用者')"><i class="fa-solid fa-user-plus"></i> 新增使用者</button>
                    </div>
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-slate-500"><tr><th class="p-4">姓名</th><th class="p-4">角色權限</th><th class="p-4">狀態</th><th class="p-4">操作</th></tr></thead>
                        <tbody class="divide-y">
                            ${db.users.map(u => `
                                <tr class="hover:bg-slate-50">
                                    <td class="p-4 font-bold text-slate-700"><i class="fa-solid fa-user-circle text-gray-300 mr-2"></i> ${u.name}</td>
                                    <td class="p-4"><span class="bg-gray-100 px-2 py-1 rounded text-xs uppercase">${u.role}</span></td>
                                    <td class="p-4"><span class="text-green-600 text-sm">● 啟用中</span></td>
                                    <td class="p-4"><button class="text-blue-600 hover:underline" onclick="alert('編輯權限: ${u.name}')">編輯</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // --- CONSULTANT: LEADS MANAGE ---
        function renderLeadsManage() {
            document.getElementById('header-title').innerText = '線索跟進管理';
            const main = document.getElementById('main-view');
            main.innerHTML = `
                <div class="grid grid-cols-3 gap-6">
                    <!-- List -->
                    <div class="col-span-1 bg-white rounded-xl shadow-sm p-4 h-[80vh] overflow-y-auto">
                        <h3 class="font-bold mb-4">待跟進線索</h3>
                        <div class="space-y-3">
                            ${db.leads.map(l => `
                                <div onclick="showLeadDetail('${l.id}')" class="p-4 border rounded-lg cursor-pointer hover:border-psf-500 hover:bg-psf-50 transition">
                                    <div class="flex justify-between mb-1"><span class="font-bold">${l.name}</span><span class="text-xs text-gray-400">2h ago</span></div>
                                    <div class="text-sm text-gray-500">${l.status === 'new' ? '未處理' : '跟進中'}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <!-- Detail -->
                    <div class="col-span-2 bg-white rounded-xl shadow-sm p-6 h-[80vh] overflow-y-auto" id="lead-detail-panel">
                        <div class="flex items-center justify-center h-full text-gray-400">請選擇左側線索以查看詳情</div>
                    </div>
                </div>
            `;
        }

        function showLeadDetail(id) {
            const l = db.leads.find(x => x.id === id);
            const panel = document.getElementById('lead-detail-panel');
            panel.innerHTML = `
                <div class="flex justify-between items-start mb-6 border-b pb-4">
                    <div><h2 class="text-2xl font-bold text-slate-800">${l.name}</h2><div class="text-sm text-gray-500">來源：Line OA</div></div>
                    <div class="flex gap-2">
                        <button class="bg-gray-100 px-3 py-1 rounded hover:bg-gray-200" onclick="alert('編輯資料')">編輯資料</button>
                        <button class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700" onclick="alert('轉為案件')">轉案件</button>
                    </div>
                </div>
                <div class="mb-6">
                    <h4 class="font-bold mb-2">跟進歷程 (Follow-up History)</h4>
                    <div class="space-y-4 pl-4 border-l-2 border-gray-200">
                        ${l.history.map(h => `
                            <div class="relative">
                                <div class="absolute -left-[21px] w-3 h-3 bg-gray-400 rounded-full border-2 border-white"></div>
                                <div class="text-xs text-gray-400">${h.date} - ${h.user}</div>
                                <div class="text-sm text-slate-700 bg-gray-50 p-2 rounded mt-1">${h.note}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="border-t pt-4">
                    <textarea class="w-full border rounded p-2 mb-2" placeholder="輸入新的跟進紀錄..."></textarea>
                    <div class="flex justify-end"><button class="bg-psf-600 text-white px-4 py-2 rounded" onclick="alert('紀錄已儲存')">新增紀錄</button></div>
                </div>
            `;
        }

        // --- OTHER VIEWS (Simplified for V4.1) ---
        function renderClientDashboard() { document.getElementById('header-title').innerText = '我的案件'; document.getElementById('main-view').innerHTML = '<div class="text-center mt-20 text-gray-400">客戶案件視圖 (參見 V4.0)</div>'; }
        function renderConsultantDashboard() { document.getElementById('header-title').innerText = '案件總管'; document.getElementById('main-view').innerHTML = '<div class="text-center mt-20 text-gray-400">案件看板視圖 (參見 V3.0)</div>'; }
        function renderPartnerDashboard() { document.getElementById('header-title').innerText = '夥伴中心'; document.getElementById('main-view').innerHTML = '<div class="text-center mt-20 text-gray-400">夥伴報表視圖 (參見 V4.0)</div>'; }
    </script>
</body>
</html>
